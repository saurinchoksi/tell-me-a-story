<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transcription Validator</title>
  <link rel="stylesheet" href="validator.css">
  <script>
    // Apply theme before body renders to prevent flash
    (function() {
      var saved = localStorage.getItem('validator-theme');
      if (saved) document.documentElement.setAttribute('data-theme', saved);
      else if (window.matchMedia('(prefers-color-scheme: dark)').matches)
        document.documentElement.setAttribute('data-theme', 'dark');
    })();
  </script>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <h1>Transcription Validator</h1>
    <select id="session-select">
      <option value="">Select a session...</option>
    </select>
    <div class="header-time" id="time-display">00:00.0 / 00:00.0</div>
  </div>

  <!-- Minimap -->
  <div id="minimap"></div>

  <!-- Waveform -->
  <div id="waveform"></div>

  <!-- Controls -->
  <div class="controls">
    <button class="play-btn" id="play-btn">
      <svg id="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      <svg id="pause-icon" style="display:none" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
    </button>
    <div class="speed-buttons">
      <button class="speed-btn" data-speed="0.5">0.5x</button>
      <button class="speed-btn active" data-speed="1">1x</button>
      <button class="speed-btn" data-speed="1.5">1.5x</button>
    </div>
    <button class="notes-toggle-btn" id="notes-toggle-btn">
      Notes <span class="note-count" id="notes-count-badge">0</span>
    </button>
    <button class="filter-toggle-btn" id="silence-gap-toggle-btn"
            title="Dim single-word segments where diarization detected no speaker.">
      Silence Gap
    </button>
    <button class="filter-toggle-btn" id="near-zero-toggle-btn"
            title="Dim single-word segments where Whisper has near-zero confidence (prob &lt; 0.01).">
      Near-Zero Prob
    </button>
    <button class="filter-toggle-btn" id="duplicates-toggle-btn"
            title="Dim segments whose text duplicates an earlier segment. Review aid — real repetitions may also match.">
      Duplicates
    </button>
    <button class="theme-toggle-btn" id="theme-toggle" title="Toggle light/dark mode">
      <span class="theme-icon-light">☀</span>
      <span class="theme-icon-dark">☾</span>
    </button>
  </div>

  <!-- Segments List -->
  <div id="segments">
    <div class="empty-state">Select a session to begin</div>
  </div>

  <!-- Note Modal -->
  <div class="modal-overlay" id="note-modal">
    <div class="modal">
      <h3 id="note-modal-title">Add Note for Segment <span id="note-segment-id"></span></h3>
      <textarea id="note-text" placeholder="Enter your note..."></textarea>
      <div class="modal-buttons">
        <button class="modal-btn modal-btn-cancel" id="note-cancel">Cancel</button>
        <button class="modal-btn modal-btn-save" id="note-save">Save</button>
      </div>
    </div>
  </div>

  <!-- Context Menu -->
  <div class="context-menu" id="context-menu">
    <div class="context-menu-item" id="context-add-note">Add Note</div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading">
    <div class="loading-spinner"></div>
  </div>

  <!-- Notes Panel -->
  <div class="notes-panel" id="notes-panel">
    <div class="notes-panel-header">
      <button id="delete-all-notes" onclick="deleteAllNotes()">Delete All</button>
      <button class="notes-panel-close" id="notes-panel-close">&times;</button>
    </div>
    <div class="drawer-tabs">
      <button class="drawer-tab active" data-tab="notes">
        Notes <span class="note-count" id="tab-notes-count">0</span>
      </button>
      <button class="drawer-tab" data-tab="low-confidence">
        Low Confidence <span class="filtered-words-count" id="tab-lc-count">0</span>
      </button>
    </div>
    <div class="drawer-tab-content active" id="tab-content-notes">
      <div class="notes-list" id="notes-list">
        <div class="notes-list-empty">
          <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 6h24l8 8v28a2 2 0 0 1-2 2H10a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z"/>
            <path d="M32 6v8h8"/>
            <path d="M16 24h16"/>
            <path d="M16 32h10"/>
          </svg>
          <span class="empty-title">No notes yet</span>
          <span class="empty-hint">Right-click a word or press <kbd>N</kbd></span>
        </div>
      </div>
    </div>
    <div class="drawer-tab-content" id="tab-content-low-confidence">
      <div class="notes-list" id="low-confidence-list">
        <div class="notes-list-empty">
          <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="24" cy="24" r="20"/>
            <path d="M16 24l5 5 11-11"/>
          </svg>
          <span class="empty-title">All words confident</span>
          <span class="empty-hint">Whisper was sure about every word</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Keyboard Hints -->
  <div class="keyboard-hints">
    <span><kbd>Space</kbd> Play/Pause</span>
    <span><kbd>←</kbd><kbd>→</kbd> ±1s</span>
    <span><kbd>↑</kbd><kbd>↓</kbd> Prev/Next Segment</span>
    <span><kbd>N</kbd> Add Note</span>
    <span><kbd>Shift+N</kbd> Notes Panel</span>
    <span><kbd>G</kbd> Silence Gap</span>
    <span><kbd>Z</kbd> Near-Zero Prob</span>
    <span><kbd>D</kbd> Duplicates</span>
    <span><kbd>T</kbd> Toggle Theme</span>
  </div>

  <script type="module" src="validator.js"></script>
</body>
</html>
