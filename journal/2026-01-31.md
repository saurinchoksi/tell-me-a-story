# 2026-01-31 — Whisper Audio Length Threshold Found

## Summary
Narrowed down the exact audio length threshold where Whisper's transcription changes — to the hundredth of a second. The number: **189.21s** (3:09.21). Below 189.20s, Whisper misses the parent's repeated question. At 189.23s and above, both speakers captured. Validated with 12 trials: 100% deterministic, no randomness.

## The Investigation

**Problem discovered yesterday:** Same Whisper model, same parameters, same pipeline — but short audio samples (~38s) dropped content that full recordings captured. Specifically: parent repeating child's question ("Why do the Pandavas and Kauravas want to be king?") at ~20-23s.

**Yesterday's bounds:**
- 180s (3 min) → utterance MISSING
- 210s (3.5 min) → utterance PRESENT

**Today's task:** Binary search to find exact threshold within 1 second.

## Binary Search Results

Created `scripts/find_whisper_threshold.py` to automate:
1. Generate temp audio sample at midpoint length (ffmpeg)
2. Run full pipeline (transcription + diarization)
3. Check segments 5-25s for target phrases
4. Count occurrences (need 2: child's question + parent's repeat)
5. Narrow range based on result

**THRESHOLD: 189.21s (3:09.21) — precise to 0.03s**

| Duration | Captures Parent's Repeat |
|----------|-------------------------|
| 189.20s  | No (child only)         |
| 189.23s  | Yes (both speakers)     |

The flip happens in a 30ms window. Not gradual — a hard edge.

## Validation

Ran 3 trials at each of 4 test points (12 total runs):

```
189.20s: [1, 1, 1] - ALWAYS MISSING
189.23s: [2, 2, 2] - ALWAYS PRESENT
189.24s: [2, 2, 2] - ALWAYS PRESENT
189.27s: [2, 2, 2] - ALWAYS PRESENT
```

**100% deterministic.** Same result every time at each length. No randomness in Whisper's behavior — the threshold is a hard boundary.

## Why This Matters

The pattern: "Dad, why do the Fondos want to be king?" (child, quiet, ~7-18s) → "Why do the Fondos want to be king?" (parent repeat, ~19-22s).

Whisper needs trailing audio context to decode quiet speech. With ~189s of total audio, it has enough context to go back and correctly transcribe the parent's repeat. With less, that segment gets skipped.

**Practical guidance:** Recordings should be 3+ minutes for reliable transcription of quiet child speech.

## Script Fix

Initial script had bugs:
1. Used `transcribe()` directly instead of full pipeline
2. Was checking wrong time window (19-24s instead of 5-25s)
3. Wasn't counting occurrences — just checking presence

Once fixed, the length-dependent behavior reproduced with 100% consistency across 12 validation runs.

## What's Next

This is valuable knowledge for the project:
- Don't test with short samples — results will be misleading
- ESP32 capture device should buffer longer recordings
- Could document in whisper-notes.md for future reference

Also pending from earlier sessions:
- LLM speaker assignment review (DeepSeek R1 8B results)
- Sanskrit name correction approach
- LinkedIn post about the project

## Technical State
- 43+ tests passing
- New script: `scripts/find_whisper_threshold.py`
- Understanding: Whisper's 30-second chunk processing benefits from longer audio context
