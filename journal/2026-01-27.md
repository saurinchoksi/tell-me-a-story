# Journal: 2026-01-27

## Session: Validation Player Spec + Orchestration Research

### What Happened

Designed the validation player tool for easier transcript review. Started with simple requirements (play audio, see utterances) and iterated to full spec:

**Final spec includes:**
- Flask server (6 endpoints) serving audio, transcripts, notes
- HTML UI with wavesurfer.js waveform
- Dropdown to select recording (auto-discovers from sessions/processed/)
- Current utterance highlighted, auto-scrolls
- Word-level highlighting within utterances using word timestamps
- UNKNOWN speaker segments visually distinct
- Keyboard shortcuts: space (play/pause), arrows (skip/navigate), N (add note)
- Click utterance to seek
- Notes persist to JSON files in tools/validation-notes/
- Auto-capture timestamp when adding note

**Architecture decision:** Two-file approach (server.py + player.html) instead of single HTML. Server handles file I/O and discovery, UI stays clean.

### Research: Claude Code Orchestration

Deep dive into current best practices for sub-agents and automation:

**Built-in sub-agents:**
- Explore: Haiku model, read-only, fast codebase search
- Plan: Sonnet, used in plan mode for research/architecture
- General-purpose: Sonnet, multi-step tasks with full tools

**Custom sub-agents:**
- Markdown files in .claude/agents/ with YAML frontmatter
- Each gets isolated 200k context window
- Can restrict tools, specify model
- Pipeline pattern: chain agents via hooks (PubNub approach)

**Ralph Wiggum pattern:** Official plugin for autonomous loops. Re-feeds same prompt until completion. Burns tokens fast.

**Key principles learned:**
- Context isolation prevents main context bloat
- Orchestrator stays minimal
- CLAUDE.md encodes project conventions
- Sub-agents can't spawn sub-agents
- Test-first patterns work well with sub-agents

**Recommendation for validation player:** Minimal orchestration. Use built-in agents naturally, start in Plan mode. Save custom sub-agent orchestration for bigger systems.

### SYNC.md Written

Complete spec with:
- All server endpoints detailed
- UI layout and interaction patterns
- 14 success criteria
- Technical notes (wavesurfer setup, time sync logic)
- Orchestration guidance (Plan mode first, build incrementally)
- Thinking level: HIGH

### Learnings

1. **Spec iteration is valuable** — Started with basic playback, ended with word-level highlighting, notes system, full keyboard shortcuts. Each addition came from thinking through actual validation workflow.

2. **Orchestration has overhead** — Custom sub-agents powerful but add complexity. Match tool to task size. Validation player is scoped enough for natural agent usage.

3. **Plan mode exists for a reason** — Multiple coordinated parts (server, UI, state sync, persistence) warrant deliberate architecture thinking upfront.

### Next Steps

1. Kick off Claude Code with SYNC.md
2. Test validation player with both recordings
3. Use player to review transcripts, capture notes
4. Findings inform next pipeline improvements
