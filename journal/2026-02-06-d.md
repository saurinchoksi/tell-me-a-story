# 2026-02-06d — Normalization Validation on Real Audio

## Session Type
Build — validation + bug fix

## What Happened

Ran the normalization pipeline against the actual Mahabharata bedtime story recording for the first time. Built a step-through validation script (`validate_normalization.py`) that runs LLM and dictionary passes individually, pausing between each step so you can inspect the corrections before applying.

### First Run: Punctuation Bug
LLM returned 5 corrections (all correct), but only 6 words changed out of ~20+ expected matches. Suspected trailing punctuation — Whisper attaches commas and periods to words like `" Dhrashtra,"`. Inspected the raw transcript JSON and confirmed: stripped form `"Dhrashtra,"` doesn't match lookup key `"dhrashtra"`.

### The Fix
Added trailing punctuation stripping to `apply_corrections` in `corrections.py`. Regex separates the bare word from trailing punctuation before lookup, reattaches after correction. Design choice: `_original` stores the full stripped word (with punctuation — that's Whisper's output), but `_corrections` chain tracks only the bare name (`from: "Dhrashtra"`, `to: "Dhritarashtra"`). Punctuation is mechanical, not part of the correction.

### Second Run: 30 Corrections
LLM: 18 corrections — fondos→Pandavas (7), goros→Kauravas (4), Yudister→Yudhishthira (3), Fondo→Pandu (3), Dhrashtra→Dhritarashtra (1).
Dictionary: 12 corrections — Duryodhan→Duryodhana (8), Yudhisthir→Yudhishthira (4).

The two passes split perfectly with zero overlap. LLM catches the wild phonetic leaps that require context. Dictionary catches the predictable variant spellings. Zero false positives.

### Remaining Gaps
- "Pondavas" (1 instance) — LLM missed it, wasn't in dictionary. Added to `mahabharata.json`.
- "Yudhisthir's" (4 instances) — possessive `'s` not handled by punctuation stripping. Tracked for future fix.

## Key Decisions

- **Fix punctuation before continuing validation.** Could have noted it and kept going, but the fix was straightforward and seeing the real correction counts was more valuable.
- **`_corrections` tracks bare names, not punctuated forms.** Cleaner audit trail.

## Reflection

Satisfying to see the full pipeline work on real data. The correction chain concept proved out — LLM and dictionary each handle their lane cleanly. The punctuation bug was the kind of thing you only find by running on real data. Validation scripts that let you pause and inspect are worth building.

## What's Next
- Fix possessives in apply_corrections
- Full end-to-end pipeline run
- Clean up pre-existing diarize test failure
